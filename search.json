[{"path":"index.html","id":"overview","chapter":"Overview","heading":"Overview","text":"documentation work progress. Potential discrepancies omissions may exist time . find , contact us .spadesCBM modular, transparent, spatially explicit implementation logic, pools structure, equations, default assumptions Carbon Budget Model Canadian Forest Sector (CBM). applies science presented Kurz et al. (2009) similar way simulations Boisvenue et al. (2016) Boisvenue et al. (2022) calls Python functions annual processes (see libcbm_py/examples/cbm_exn). functions spadesCBM , like much modelling-based science, continuously development.collection SpaDES modules spadesCBM developed enable R&D input Canadian Forest Service (CFS) forest carbon reporting system, NFCMARS, National Forest Carbon Monitoring, Accounting, Reporting system. CFS provides science backing Canadian policies national forest issues. spadesCBM nimble tool new science, data algorithms can tested explored serve policy purposes. spadesCBM development follows PERFICT approach McIntire et al. (2022) ecological modelling systems, approach helps solve many complex issues ecological modelling, supports continuous workflows, nimble, enter operable modelling systems. SpaDES platform toolkit enables implementation PERFICT principle.","code":""},{"path":"index.html","id":"usage","chapter":"Overview","heading":"Usage","text":"Four modules need run tandem spadesCBM simulation.\nfirst module, CBM_defaults, reads defaults CBM parameters Canada. second module, CBM_dataPrep_SK, data preparation SpaDES module, input data spatial layers assembled prepared specific study area. CBM_dataPrep_SK module study-area scenario specific.\nThroughout manual use example simulation forest carbon dynamics managed forests Saskatchewan (SK) 1985-2012 similarly simulations Boisvenue et al. (2016), SK indicates study area.\nspadesCBM, CBM, growth curves (\\(m^3/ha\\)) main change-agent.\nCBM_vol2biomass module translates user-provided stand-level growth curves (\\(m^3/ha\\)) increments specific ground carbon pools (metric tonnes carbon/ha) using Boudewyn et al. (2007) models (leading species specific) added smoothing algorithm fill-gap age 0 age growth curves data.\nNote CBM_vol2biomass also study-area specific, Boudewyn et al. (2007) parameters dominant species ecozone specific.CBM_defaults, CBM_vol2biomass one event (init), need run (note cached example).CBM_dataPrep_SK processes data init event, also second event annual disturbances processed (readDisturbanceEvents). second event enables dynamic linkages disturbance models.\nthree modules provide inputs CBM_core module, carbon-transfers pools applied specified time step (example, yearly).\nmodularity enables users access change default parameters, change inputs, connect dynamically external modules modify landscape, assess impact changes.\nworking various implementations modelling system making available community Preditive Ecology GitHub repository.\nhope others .\nsmaller study area extent simulation spadesCBM available SpaDES training manual.insert moduleDiagramSeveral core utilities spadesCBM provided CBMutils package, available GitHub. SpaDES platform much broader scope use spadesCBM. provide basic SpaDES definitions users can perform spadesCBM simulations without learn SpaDES capacities. CBMutils functions used example listed brief explanation subsequent section. Active development CBMutils spadesCBM modules underway.","code":""},{"path":"index.html","id":"the-carbon-budget-model-in-spades","chapter":"Overview","heading":"The Carbon Budget Model in SpaDES","text":"Carbon Budget Model (CBM) first developed early 1990s (Kurz et al. (1993)). implementation platform model inter-operability nimbleness SpaDES warrants overview.spadesCBM simulates forest carbon dynamics given study area based Canadian-parameterization user-provided growth inventory information. Default Canadian parameters read-(CBM_defaults), matched user-provided information (CBM_dataPrep_SK CBM_vol2biomass), information drives carbon-transfers simulations (CBM_core).","code":""},{"path":"index.html","id":"input-requirements","chapter":"Overview","heading":"Input requirements","text":"spadesCBM simulations require study area information, age, leading species stand pixel simulate landscape, growth information stand pixel. Users can provide information various format processed CBM_dataPrep_SK CBM_vol2biomass. suggest users modify example provided represent study area inventory information. module chapter module inputs outputs listed.","code":""},{"path":"index.html","id":"pools","chapter":"Overview","heading":"Pools","text":"18 internal carbon pools spadesCBM, representing stand pixel (Table 1), two pools take carbon system, Products Atmosphere. carbon transfers dictated matrices (available defaults information) specify proportion carbon moving one pool (source_pool another (sink_pools). Matrices growth populated user-provided growth information main change agent system, providing carbon input stand. Default parameters biomass dead organic mater (DOM) turnover, decay, soil mixing either provincial/territorial, ecozone, Canada-wide scale (see Table 1 Kurz et al. (2009)). Note parameters can easily modified defaults spadesCBM simulation. Disturbances matrices representing carbon-transfers disturbances like fire harvesting, available defaults (read-via CBM_defaults) managed forests Canada. Figure XX gives example transfers fire SK. INSERT VINIâ€™S DIST MATRIX TRANSFER FIGURETable 1: Carbon pools spadesCBM","code":""},{"path":"index.html","id":"order-of-operations","chapter":"Overview","heading":"Order of operations","text":"simulations, disturbances occur carbon-transfer. disturbances, half growth (determined increments user-provided growth curve) applied followed transfers representing DOM turnover, live biomass turnover, overmature decline compensation applicable, 2nd half growth, DOM decay, slow decay slow soil mixing. previously stated, carbon additions system come atmosphere (amount determined growth via user-provided growth curves), carbon exists system atmosphere forest products sector (ADD FIGURE MODIFICATION CBM_slide.ppt). Transfers proportions source pool sink pools proportions add 1, carbon lost.MAKE TABLE \ndisturbance\nhalf growth\ndomturnover\nbioturnover\novermaturedecline\n2nd half growth\ndomdecay\nslowdecay\nslowmixing","code":""},{"path":"index.html","id":"the-spinup-function","chapter":"Overview","heading":"The spinup function","text":"amount carbon ground forests extremely variable consequently data can provide information scales greater plot levels. compensate gap knowledge data, prior simulation, CBM_core completes process populates ground pools. process called spinup first event CBM_core module. procedure consists growing burning forest stand, according provided growth curves default values fire return intervals (provided CBM_defaults) ground carbon pool stabilize reach predefined number simulations. choice fire disturbance matches historical forest disturbance forests Canada. consider procedure place holder knowledge ground carbon dynamics improves. Although likely resulting errors absolute carbon stocks (see Boisvenue et al. (2022) Appendix 4), systematic errors can least simulate trends carbon stocks fluxes. Research compared ground stocks values (Shaw (2008)) work continues improve parameters (Hararuk (2017) ?).","code":""},{"path":"index.html","id":"setup","chapter":"Overview","heading":"Setup","text":"example, setup workflow using \nSpaDES.project package \ncurrent versions spadesCBM modules.","code":""},{"path":"index.html","id":"google-account-needed-for-this-example","chapter":"Overview","heading":"0.1 Google account needed for this example","text":"run provided example, users need access data using googledrive R package (part tidyverse family R packages).\nsimInit() (simInitAndSpades) call, function initialize (initialize run) SpaDES-based simulations, R prompt either choose previously authenticated account (previously used googledrive) open browser window authenticate.Make sure give tidyverse read/write access files:","code":""},{"path":"index.html","id":"python-is-required-for-this-example","chapter":"Overview","heading":"0.2 Python is required for this example","text":"CBM_core module, simulation module spadesCBM, requires Python >=3.9 <=3.12.7.suitable version Python already exist computer,\nSpaDES.project::setupProject use reticulate package install using pyenv pyenv-win.using Windows computer Git installed, pyenv-win tool acquired managed directly reticulate. using Windows computer without Git installed, prompted allow pyenv-win tool downloaded directly Github local user application data directory (tools::R_user_dir(\"r-spadesCBM\")).Python installation process fails prefer manually install Python, can downloaded directly python.org/downloads. calls Python functions package called libcbm. Python functions used CBM_core module. Details CBM_core module Python functions provided CBM_core chapter manual.","code":""},{"path":"index.html","id":"run-example-simulation","chapter":"Overview","heading":"Run Example Simulation","text":"R script run simulation forest carbon dynamics managed forests SK 1985 2012, disturbances presented Boisvenue et al. (2016). Depending computing capacity, may take , particularly first time run . Subsequent simulations much faster use reproducible::Cache function.","code":"# set project paths and install packages\nprojectPath <- \"~/GitHub/spadesCBM\"\nrepos <- unique(c(\"predictiveecology.r-universe.dev\", getOption(\"repos\")))\ninstall.packages(\"SpaDES.project\",\n                 repos = repos)\n\n# Set simulation period.In this example we start in 1985, and end in 2011\ntimes <- list(start = 1985, end = 2011)\n\n# This is our setupProject call. This creates the model's folder structure, downloads modules, installs and loads needed packages, and sets options.\nout <- SpaDES.project::setupProject(\n  Restart = TRUE,\n  useGit = \"PredictiveEcology\", # a developer sets and keeps this = TRUE\n  overwrite = TRUE, # a user who wants to get latest modules sets this to TRUE\n  paths = list(projectPath = projectPath),\n\n  options = options(\n    repos = c(repos = repos),\n    Require.cloneFrom = Sys.getenv(\"R_LIBS_USER\"),\n    reproducible.destinationPath = \"inputs\",\n    ## These are for speed\n    reproducible.useMemoise = TRUE,\n    # Require.offlineMode = TRUE,\n    spades.moduleCodeChecks = FALSE\n  ),\n  modules =  c(\"PredictiveEcology/CBM_defaults@development\",\n               \"PredictiveEcology/CBM_dataPrep_SK@development\",\n               \"PredictiveEcology/CBM_vol2biomass@development\",\n               \"PredictiveEcology/CBM_core@development\"),\n  times = times,\n  require = c(\"SpaDES.core\", \"reticulate\",\n              \"PredictiveEcology/libcbmr\", \"data.table\"),\n\n  params = list(\n    CBM_defaults = list(\n      .useCache = TRUE\n    ),\n    CBM_dataPrep_SK = list(\n      .useCache = TRUE\n    ),\n    CBM_vol2biomass = list(\n      .useCache = TRUE\n    )\n  ),\n  functions = \"PredictiveEcology/CBM_core@training/R/ReticulateFindPython.R\",\n\n  ret = {\n    reticulate::virtualenv_create(\n      \"r-spadesCBM\",\n      python = if (!reticulate::virtualenv_exists(\"r-spadesCBM\")){\n        ReticulateFindPython(\n          version        = \">=3.9,<=3.12.7\",\n          versionInstall = \"3.10:latest\",\n          pyenvRoot      = tools::R_user_dir(\"r-spadesCBM\")\n        )\n      },\n      packages = c(\n        \"numpy<2\",\n        \"pandas>=1.1.5\",\n        \"scipy\",\n        \"numexpr>=2.8.7\",\n        \"numba\",\n        \"pyyaml\",\n        \"mock\",\n        \"openpyxl\",\n        \"libcbm\"\n      )\n    )\n    reticulate::use_virtualenv(\"r-spadesCBM\")\n  },\n\n  #### begin manually passed inputs #########################################\n  ## define the  study area.\n  masterRaster = {\n    mr <- reproducible::prepInputs(url = \"https://drive.google.com/file/d/1zUyFH8k6Ef4c_GiWMInKbwAl6m6gvLJW/view?usp=drive_link\",\n                                   destinationPath = \"inputs\")\n    mr[mr[] == 0] <- NA\n    mr\n  },\n\n  disturbanceRastersURL = \"https://drive.google.com/file/d/12YnuQYytjcBej0_kdodLchPg7z9LygCt\",\n\n  outputs = as.data.frame(expand.grid(objectName = c(\"cbmPools\", \"NPP\"),\n                                      saveTime = sort(c(times$start,\n                                                        times$start +\n                                                          c(1:(times$end - times$start))\n                                      )))),\n\n)\n\n# Run simulation\nsimMngedSK <- SpaDES.core::simInitAndSpades2(out)"},{"path":"lexicon.html","id":"lexicon","chapter":"Lexicon","heading":"Lexicon","text":"first time encountering model built within SpaDES framework, may unfamiliar several terms used manual. offer lexicon help familiarize users terms concepts relevant spadesCBM. comprehensive guide introduction robust nimble scientific workflows using SpaDES can found .","code":""},{"path":"lexicon.html","id":"basic-spades-concepts","chapter":"Lexicon","heading":"Basic SpaDES concepts","text":"Modules\nEvents\nFunctions\nSimlist\nEvents\nspinup\nsetupProject()\nsimInitAndSpades2()\n.inputObjects()\nprepInputs()","code":""},{"path":"lexicon.html","id":"spadescbm-terms","chapter":"Lexicon","heading":"spadesCBM terms","text":"source_pool\nsink_pool\nCBM-CFS3 vs spadesCBM\npixelGroups\necozone/spatial units","code":""},{"path":"cbmutils.html","id":"cbmutils","chapter":"CBMutils","heading":"CBMutils","text":"documentation work progress. Potential discrepancies omissions may exist time . find regarding module, contact us .CBMutils package available GitHub. provides several core utilities spadesCBM. spadesCBM modules, development ongoing.","code":""},{"path":"cbmutils.html","id":"notable-functions-and-usage","chapter":"CBMutils","heading":"Notable functions and usage","text":"","code":""},{"path":"cbm_defaults.html","id":"cbm_defaults","chapter":"1 CBM_defaults","heading":"1 CBM_defaults","text":"documentation work progress. Potential discrepancies omissions may exist time . find regarding module, contact us .","code":""},{"path":"cbm_defaults.html","id":"overview-1","chapter":"1 CBM_defaults","heading":"1.1 Overview","text":"CBM_defaults reads default parameters managed forest Canada. SpaDES-speak, one event (init). , module provides R-based access defaults CBM parameters managed forests Canada. part spadesCBM, provides simulations default parameter values managed forests Canada, akin Archive Index CBM-CFS3 documentation. parameters read SQLite database (link ), defaults, modified CBM-CFS3 accommodate flexible representation vegetation dynamics enable libcbm Python functions used, available . Defaults managed forests Canada include disturbance data different disturbance types IDs, spinup parameters, pool names, fire return intervals ecozone (DEFINE) . outputs module used CBM_dataPrep_SK CBM_core spadesCBM simulations.","code":""},{"path":"cbm_defaults.html","id":"background","chapter":"1 CBM_defaults","heading":"1.2 Background","text":"example uses default parameters created use CBM-CFS3. parameters source references. ones outline Operational-scale Carbon Budget Model Canadian Forest Sector (CBM-CFS3) version 1.2: userâ€™s guide. CBM_defaults brings parameters R-environment, easy user-access modifications.","code":""},{"path":"cbm_defaults.html","id":"inputs","chapter":"1 CBM_defaults","heading":"1.3 Inputs","text":"","code":""},{"path":"cbm_defaults.html","id":"module-functioning","chapter":"1 CBM_defaults","heading":"1.4 Module functioning","text":"SQLite database, selection cbm_exn resource files downloaded stored userâ€™s Inputs folder GitHub using reproducible::prepInputs function, useful tool SpaDES toolkit.Parameters necessary spadesCBM simulations extracted downloaded files. saved objects simList (see list output objects ).species_tr object created match species name user-provided growth curve.disturbanceMatrix cTransfers objects help identify carbon transfers matches provided disturbances matches transfer matrix IDs proportions transferred disturbance names.Parameters spinup event CBM_core modules assembled spinupSQL object.pooldef gives names carbon pool exists CBM.Objects narrow parameter selection study area spuLocator ecolocator","code":""},{"path":"cbm_defaults.html","id":"outputs","chapter":"1 CBM_defaults","heading":"1.5 Outputs","text":"","code":""},{"path":"cbm_defaults.html","id":"usage-1","chapter":"1 CBM_defaults","heading":"1.6 Usage","text":"module can run independently running global script . Run independently, provides transparent access default parameters managed forests Canada spadesCBM simulations.","code":"\nprojectPath <- \"~/CBM_defaults\"\nrepos <- c(\"predictiveecology.r-universe.dev\", getOption(\"repos\"))\nif ((packageVersion(\"SpaDES.project\") < \"0.1.1\" || packageVersion(\"Require\") < \"1.0.1.9002\") |>\n    tryCatch(error = function(x) TRUE))\n  install.packages(c(\"SpaDES.project\", \"Require\"), repos = repos)\n\nout <- SpaDES.project::setupProject(\n  paths = list(projectPath = projectPath),\n  \n  options = options(\n    repos = c(repos = repos),\n    reproducible.destinationPath = \"inputs\"\n  ),\n  modules =  c(\"PredictiveEcology/CBM_defaults@main\"),\n  require = c(\"SpaDES.core\"),\n)\n\noutDefaults <- SpaDES.core::simInitAndSpades2(out)"},{"path":"cbm_defaults.html","id":"links-to-other-modules","chapter":"1 CBM_defaults","heading":"1.7 Links to other modules","text":"CBM_dataPrep_SKCBM_vol2biomassCBM_core","code":""},{"path":"cbm_dataprep_sk.html","id":"cbm_dataprep_sk","chapter":"2 CBM_dataPrep_SK","heading":"2 CBM_dataPrep_SK","text":"documentation work progress. Potential discrepancies omissions may exist time . find regarding module, contact us .","code":""},{"path":"cbm_dataprep_sk.html","id":"overview-2","chapter":"2 CBM_dataPrep_SK","heading":"2.1 Overview","text":"CBM_dataPrep_SK processes spatially explicit inputs use CBM_vol2biomass CBM_core. SpaDES-speak, one event (init) - might now change two events - stay tuned. SpaDES designed spatially explicit modelling provides wide variety tools support . CBM_dataPrep_SK makes use tools. moduleâ€™s inputs study area scenario specific rasters making CBM_dataPrep_SK idiosyncratic module spadesCBM deck, meaning module require users adapt available information study area. default example simulates present day (1985-2011) scenario remotely-sensed disturbances simulated managed forests Saskatchewan, described Boisvenue et al. (2016)â€™s (scenario = time horizon + disturbances). suggest users wanting run spadesCBM study-area, modify module, adapting inputs produce outputs CBM_dataPrep_SK. module become CBM_dataPrep_NewStudyArea.","code":""},{"path":"cbm_dataprep_sk.html","id":"background-1","chapter":"2 CBM_dataPrep_SK","heading":"2.2 Background","text":"default structure SpaDES modules .inputObjects function, .inputObjects function CBM_dataPrep_SK, make use reproducible::prepInputs function important part SpaDES toolkit (see SpaDES training. CBM_dataPrep_SK falls back defaults CBM parameters running SK managed forests, unless alternative information provided user.study area spatially defined object masterRaster. object can provided directly raster, per example, created shape files means. Reminder: R-code can replace current input processing examples CBM_dataPrep_SK. characteristics (projection, resolution, etc.) masterRaster transferred rasters used simulation via function reproducible::prepInputs. example, age raster (ageRaster), raster specifying growth curves used (gcIndexRaster), location rasters link back default parameters Canada (spuRaster, ecoRaster), yearly disturbance rasters (provided list module disturbanceRaster, process annual event CBM_core module using function reproducible::postProcess, part reproducible::prepInputs function) matched masterRaster. Defaults parameters expected CBM_defaults (spinupSQL, species_tr) one table provided cbmAdmin user convenience. addition location (study area) inventory information (age, provided raster), user expected provide: growth curves (\\(m^3/ha\\)) linked pixel stand (userGcM3), leading species curve (gcMeta), information disturbances (userDist).","code":""},{"path":"cbm_dataprep_sk.html","id":"inputs-1","chapter":"2 CBM_dataPrep_SK","heading":"2.3 Inputs","text":"","code":""},{"path":"cbm_dataprep_sk.html","id":"module-functioning-1","chapter":"2 CBM_dataPrep_SK","heading":"2.4 Module functioning","text":"Two central pieces processed CBM_dataPrep_SK: pixelGroups created disturbances matched disturbance matrices.","code":""},{"path":"cbm_dataprep_sk.html","id":"pixel-groups","chapter":"2 CBM_dataPrep_SK","heading":"2.4.1 Pixel Groups","text":"pixelGroup unique combinations age, growth curve (means species), spatial unit ecozone. pixels identical age, growth curve, spatial unit ecozone share one pixelGroup number. object allPixelDT mixels masterRaster. spatialDT object long-form simulated pixel line (N/pixels), level3DT lists pixel groups. example 1 347 529 pixels simulated (.e., 1 347 529 pixels spatialDT) grouped 739 pixelGroups actual processing.","code":""},{"path":"cbm_dataprep_sk.html","id":"disturbances","chapter":"2 CBM_dataPrep_SK","heading":"2.4.2 Disturbances","text":"user identifies disturbances occur landscape simulations. example points file (userGcM3) disturbance name description. table also provides number raster provide identify disturbances (one per year since simulations yearly), identifies disturbance whole stand disturbance . disturbances need match disturbance matrix, identifies proportion carbon transferred one pool (source pool) another pool (sink pool) disturbance occurs specific pixel study area. one match (e.g., one type fire), user prompted select list disturbance matrices available study area, spatial unit ecozone combinations. default matrices provided Canada-wide defaults region (spatial unit ecozone) specific. read-CBM_defaults available CBM_dataPrep_SK module via simList(). provide example selection example. user-prompts look like :\nMAYBE INSERT SCREEN SHOTS disturbance SELECTION PROCESS?468 unique disturbance matrices identified defaults. Since root parameters snag carbon transfer rates hardwood softwood specific rates, disturbance hardwood softwood instance, means really 234 unique disturbances across Canada defaults modelling system, one hardwood one softwood. user add modify proportions transferred pools represent disturbance (NOTE HAPPEN CSVs, even work? libcbm point files? change ? QUESTION SCOTT).\nAdd section one modify disturbance matricesParameters necessary CBM_core spinup event added level3DT object using CBM_defaults output object spinupSQL. includes match historical disturbance matrix (wildfire) specific location.series helper functions CBMutils help users explore navigate disturbance matrices: spuDist extracting disturbances specific spatial unit, simDist() lists distrubances used simulation, seeDist() pulls proportions source sink pools.growth curves can identified strata, multiple columns can used identify growth curves using curveID object. example, gcids used.","code":""},{"path":"cbm_dataprep_sk.html","id":"outputs-1","chapter":"2 CBM_dataPrep_SK","heading":"2.5 Outputs","text":"","code":""},{"path":"cbm_dataprep_sk.html","id":"links-to-other-modules-1","chapter":"2 CBM_dataPrep_SK","heading":"2.6 Links to other modules","text":"CBM_defaultsCBM_vol2biomassCBM_core","code":""},{"path":"cbm_vol2biomass.html","id":"cbm_vol2biomass","chapter":"3 CBM_vol2biomass","heading":"3 CBM_vol2biomass","text":"documentation work progress. Potential discrepancies omissions may exist time . find regarding module, contact us .","code":""},{"path":"cbm_vol2biomass.html","id":"overview-3","chapter":"3 CBM_vol2biomass","heading":"3.1 Overview","text":"module translates stand-level \\(m^3/ha\\) values user provides \\(tonnes biomass/ha\\) increments CBM_core needs simulate annual carbon fluxes estimate stocks spadesCBM simulations. implementation Boudewyn et al. (2007) stand-level translation. script similar translation procedure CBM addition \nsmoothing algorithm fill-gap age 0 age growth curves data. Like many statistical models, translation always successful. user advised review resulting biomass increments representation vegetation dynamics CBM.module can run independently spadesCBM deck. relies multiple CBMutils functions.","code":""},{"path":"cbm_vol2biomass.html","id":"inputs-2","chapter":"3 CBM_vol2biomass","heading":"3.2 Inputs","text":"Two main pieces information needed translate stand-level growth curves stand-level biomass (tonnes biomass/ha) using Boudewyn et al. (2007) approach: curves (specifying leading species) location curves applied (specifically, .e., pixel, generally, spatial unit ecozone). object UserGCM3 user provides stand-level \\(m^3/ha\\), gcMetalinks growth curve leading species, objects level3DT, ecozones, spatialUnitsprovide location information. Table 1 lists inputs module. Tables 3 7 Boudewyn et al. (2007) parameters hosted National Forest Information System website.","code":""},{"path":"cbm_vol2biomass.html","id":"module-functioning-2","chapter":"3 CBM_vol2biomass","heading":"3.3 Module functioning","text":"","code":""},{"path":"cbm_vol2biomass.html","id":"list-of-output-objects","chapter":"3 CBM_vol2biomass","heading":"3.4 List of output objects","text":"","code":""},{"path":"cbm_vol2biomass.html","id":"module-flow-rename-this-section-later","chapter":"3 CBM_vol2biomass","heading":"3.5 Module flow (rename this section later)","text":"relate:\n*INSERT CARTOONY REPRESENTATION FUNCTIONS HIEARCHYCBM_defaultsCBM_dataPrep_SKCBM_core","code":""},{"path":"cbm_vol2biomass.html","id":"user-input","chapter":"3 CBM_vol2biomass","heading":"3.5.1 User input","text":"user must provide two files growth information one location file.\nNote can provided spadesCBMinputs module spadesCBM deck used: * one metadata file (userGcMeta) minimum identifier links specific growth curve pixel study area raster (gcId - growth curve identification number) leading species curve.\n* one file gives m3 per ha age identified growth curves.\n* location information file.\ninformation preferably passed along raster spadesCBMinputs module, can -passed providing vector ecozones spatial units growth curves apply .\ninformation used identify jurisdiction (province territory) ecozone gcId , turn used determine appropriate parameters stand-level conversion m3/ha biomass per ha Boudewyn et al.Â approach.","code":""},{"path":"cbm_vol2biomass.html","id":"default-files-provided","chapter":"3 CBM_vol2biomass","heading":"3.5.2 Default files provided","text":"Two types information built module: Boudewyn et al.Â parameters tables, data frames help link CBM-specific information parameter categories.\n* URLs Boudewyn et al.Â five parameter tables built module (see .inputObjects) loaded NFIS site directly.\n* cbmAdmin data frame links CBM-specific spatial units administrative boundaries Canada ecozones.\n* canfi_species data frame provides canfi_species numbers genus abbreviations used identify correct parameters Boudewyn et al tables.\nalso specifies name tree species forest_type_id, identifier used CBM.","code":""},{"path":"cbm_vol2biomass.html","id":"pseudocode-the-general-steps","chapter":"3 CBM_vol2biomass","heading":"3.5.3 Pseudocode: the general steps","text":"module reads user userGcMeta, reads userGcM3.\nprovides plot curves userGcM3 visual inspection (sim$volCurves).\nmatches jurisdiction gcId (growth curve identification), matches leading species attaching canfi_species (number) genus leading species.\ncanfi_species genus key associating correct parameters conversion (Boudewyn et al.Â 2007).\nspecies matches complete, series functions (see package CBMutils) used go provided cumulative m3/ha curve cumulative tonnes carbon/ha ground live biomass pool (merch, foliage, ).\nvisual check provided via sim$plotsRawCumulativeBiomass.\nSince time models need smoothing, two examples smoothing, applied Saskatchewan default example, provided fitting GAMs 1) cumulative curve (per gcId) three pool, 2) fitting GAMs increments years three pools.\nCurrently, example 1) commented , example 2) used show sometimes, even perfect-looking curves need hard fixes.\nexamplee, default knots GAMs set 20 (k=20) extra weight given 0 intercept maximum value curve setting weights (wts script).\nSee http://environmentalcomputing.net/intro--gams/ guide GAMs.\n, userâ€™s responsibility decided smoothing parameters /methods appropriate.\ndefault example 1) (commented ), fitted values GAMs cumulative curves carbon/ha used calculate annual increment, dived two use spadesCBMcore.R module annual processing (half growth processes two instances).\nHalved increments can visually assessed using sim$checkInc halved increments save simList (sim$growth_increments).\nexample 2), currently executed default Saskatchewan example, increments calculated prior fitting GAMs.\nfinal step (examples), halved growth increment table hashed processing speed (sim$gcHash).\nmodule uses example region Saskatchewan default simulation can modified run independently (.e., just translation m3 ground carbon three pools).","code":""},{"path":"cbm_vol2biomass.html","id":"units","chapter":"3 CBM_vol2biomass","heading":"3.5.4 Units","text":"user provides growth curves cumulative m3/ha time one leading species (following CBM-CFS3).\ncurves fed Boudewyn algorithms (CBM_vol2biomass module) results multiplied 0.5 give carbon/ha.\ndeck modules simulates annual basis preferable cumulative curves m3/ha provided individual years.\nper individual years, GAM fitted values modified provide yearly fitted.values.\nobject cumPoolsRaw (line 411) CBM_vol2biomass.R, cumulative values three -ground live pools tonnes carbon/ha.\nfollowing values tonnes c/ha.","code":""},{"path":"cbm_vol2biomass.html","id":"output","chapter":"3 CBM_vol2biomass","heading":"3.5.5 Output","text":"module provides sim$growth_increments hashed version, sim$gcHash available spadesCBMcore module.\noutput created module visual checks growth curve processing.","code":""},{"path":"cbm_vol2biomass.html","id":"spades","chapter":"3 CBM_vol2biomass","heading":"3.5.6 SpaDES","text":"one event module (init), module scheduled .\nmodule designed part SpaDES-deck spadesCBM, SpaDES modules representing CBM-CFS3, transparent spatialized.\nfour modules family: spadesCBMdefaults, spadesSBMinputs, CBM_vol2biomass, spadesCBMcore.","code":""},{"path":"cbm_vol2biomass.html","id":"list-of-potential-improvements","chapter":"3 CBM_vol2biomass","heading":"3.5.7 list of potential improvements","text":"add check see growth curves provided annual basis , modify GAM outputs provided annual fitted value.make k (knots GAMs) user defined parameterprovide option fit GAM prior maximum value curve (0 max) number knots (k) one maximum value possibly knots.previous weights going GAMs.","code":""},{"path":"cbm_vol2biomass.html","id":"usage-2","chapter":"3 CBM_vol2biomass","heading":"3.6 Usage","text":"","code":"\nlibrary(SpaDES)\nlibrary(magrittr) # this is needed to use \"%>%\" below\nmoduleDir <- \"C:/Celine/github/spadesCBM\"\ninputDir <- file.path(moduleDir, \"inputs\") %>% reproducible::checkPath(create = TRUE)\noutputDir <- file.path(moduleDir, \"outputs\")\ncacheDir <- file.path(outputDir, \"cache\")\ntimes <- list(start = 0, end = 10)\n\nparameters <- list(\n  CBM_vol2biomass = list(.useCache = \".inputObjects\")\n  #.progress = list(type = \"text\", interval = 1), # for a progress bar\n  ## If there are further modules, each can have its own set of parameters:\n  #module1 = list(param1 = value1, param2 = value2),\n  #module2 = list(param1 = value1, param2 = value2)\n)\n\nmodules <- list(\"CBM_vol2biomass\")\nobjects <- list(\n  #userGcMetafileName <- c(\"/RIA2019/gcMetaRuns.csv\"),\n  #userGcM3 <- c(\"/RIA2019/gcRIAm3.csv\")\n\n)\npaths <- list(\n  cachePath = cacheDir,\n  modulePath = moduleDir,\n  inputPath = inputDir,\n  outputPath = outputDir\n)\noptions(\n    rasterTmpDir = inputDir,\n    reproducible.cachePath = cacheDir,\n    spades.inputPath = inputDir,\n    spades.outputPath = outputDir,\n    spades.modulePath = moduleDir\n  )\n\nmyBiomass <- simInit(times = times, params = parameters, modules = modules,\n                 objects = objects)\n\nmyBiomassOut <- spades(myBiomass)"},{"path":"cbm_core.html","id":"cbm_core","chapter":"4 CBM_core","heading":"4 CBM_core","text":"documentation work progress. Potential discrepancies omissions may exist time . find regarding module, contact us .","code":""},{"path":"cbm_core.html","id":"overview-4","chapter":"4 CBM_core","heading":"4.1 Overview","text":"core modules Spades CBM.","code":""},{"path":"cbm_core.html","id":"notes-on-forest-type","chapter":"4 CBM_core","heading":"4.1.1 Notes on forest type","text":"SQligth (used CBM_defaults) column named forest_type_id identifies softwood forest (sw) 1, mixed forest 2, hardwood forest (hw) 3. distinction important determines root biomass calculated (sw differently hw). definition fotrest_type_id constant used canfi_species.csv (species level identification codes needed volumne biomass translation CBM_vol2biomass), gcMeta.csv (SK specific growth curve metadata), sim$growth_increments built gcMeta canfi_species. sim$growth_increment$forest_type_id one used create sw flag needed input spinup event. , sw_hw flag (1=sw, 0=hw) stored sim$cbm_vars$state$sw_hw column.","code":""},{"path":"cbm_core.html","id":"background-2","chapter":"4 CBM_core","heading":"4.2 Background","text":"","code":""},{"path":"cbm_core.html","id":"inputs-3","chapter":"4 CBM_core","heading":"4.3 Inputs","text":"","code":""},{"path":"cbm_core.html","id":"module-functioning-3","chapter":"4 CBM_core","heading":"4.4 Module functioning","text":"","code":""},{"path":"cbm_core.html","id":"outputs-2","chapter":"4 CBM_core","heading":"4.5 Outputs","text":"","code":""},{"path":"cbm_core.html","id":"links-to-other-modules-2","chapter":"4 CBM_core","heading":"4.6 Links to other modules","text":"CBM_defaultsCBM_dataPrep_SKCBM_vol2biomass","code":""},{"path":"references.html","id":"references","chapter":"References","heading":"References","text":"","code":""}]
