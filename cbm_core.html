<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 4 CBM_core | spadesCBM</title>
<meta name="author" content="Céline Boisvenue">
<meta name="generator" content="bookdown 0.42 with bs4_book()">
<meta property="og:title" content="Chapter 4 CBM_core | spadesCBM">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 4 CBM_core | spadesCBM">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.9.0/transition.js"></script><script src="libs/bs3compat-0.9.0/tabs.js"></script><script src="libs/bs3compat-0.9.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="css/style.css">
<meta name="description" content="This documentation is work in progress. Potential discrepancies and omissions may exist for the time being. If you find any, please contact us here.  4.1 Overview CBM_core is the central module of...">
<meta property="og:description" content="This documentation is work in progress. Potential discrepancies and omissions may exist for the time being. If you find any, please contact us here.  4.1 Overview CBM_core is the central module of...">
<meta name="twitter:description" content="This documentation is work in progress. Potential discrepancies and omissions may exist for the time being. If you find any, please contact us here.  4.1 Overview CBM_core is the central module of...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="v. 0.1">spadesCBM</a>:
        <small class="text-muted">v. 0.1</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Overview</a></li>
<li><a class="" href="lexicon.html">Lexicon</a></li>
<li><a class="" href="cbmutils.html">CBMutils</a></li>
<li><a class="" href="cbm_defaults.html"><span class="header-section-number">1</span> CBM_defaults</a></li>
<li><a class="" href="cbm_dataprep_sk.html"><span class="header-section-number">2</span> CBM_dataPrep_SK</a></li>
<li><a class="" href="cbm_vol2biomass.html"><span class="header-section-number">3</span> CBM_vol2biomass</a></li>
<li><a class="active" href="cbm_core.html"><span class="header-section-number">4</span> CBM_core</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/PredictiveEcology/spadesCBM">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="cbm_core" class="section level1" number="4">
<h1>
<span class="header-section-number">4</span> CBM_core<a class="anchor" aria-label="anchor" href="#cbm_core"><i class="fas fa-link"></i></a>
</h1>
<div class="rmdimportant">
<p>This documentation is work in progress. Potential discrepancies and omissions may exist for the time being. If you find any, please contact us <a href="%22https://github.com/PredictiveEcology/CBM_core/issues%22">here</a>.</p>
</div>
<div id="overview-4" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> Overview<a class="anchor" aria-label="anchor" href="#overview-4"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://github.com/PredictiveEcology/CBM_core.git">CBM_core</a> is the central module of <a href="https://github.com/PredictiveEcology/spadesCBM.git">spadesCBM</a>. This is where all the carbon transfers are calculated at every time step, where disturbances are applied, and stocks are tracked. It doesn’t run on its own, it needs parameters from either <a href="https://github.com/PredictiveEcology/CBM_defaults.git">CBM_defaults</a>, <a href="https://github.com/PredictiveEcology/CBM_dataPrep_SK.git">CBM_dataPrep_SK</a>, and <a href="https://github.com/PredictiveEcology/CBM_vol2biomass.git">CBM_vol2biomass</a> or the equivalent information from the user. In <em>SpaDES-speak</em>, this module has five events (<code>init</code>, <code>spinup</code>, <code>postspinup</code>, <code>annual</code>, <code>accumulateResults</code>). Only in two of these events do carbon transactions occur: <code>spinup</code> and <code>annual</code>. The other events are tools to enable these transactions. All events are scheduled only once except for the <code>annual</code> event, who schedules itself until the end of the simulation horizon. Only in this module are the Python functions from the <a href="https://github.com/cat-cfs/libcbm_py/tree/main">libcbm</a> package called. The functions used in this module are the <a href="https://github.com/cat-cfs/libcbm_py/tree/main/libcbm/model/cbm_exn">libcbm cbm-exn</a> exclusively, these were designed to accept external biomass increments.</p>
</div>
<div id="background-3" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> Background<a class="anchor" aria-label="anchor" href="#background-3"><i class="fas fa-link"></i></a>
</h2>
<p>In <a href="https://github.com/PredictiveEcology/CBM_core.git">CBM_core</a>, the general approach described in our <a href="link%20to%20the%20overview%20section">Overview</a> section and in <span class="citation">Kurz <em>et al.</em> (<a href="references.html#ref-kurz2009">2009</a>)</span> is applied. There are 18 internal carbon pools in <a href="https://github.com/PredictiveEcology/spadesCBM.git">spadesCBM</a> (see Table 1 in Overview) and one for the atmosphere. Disturbances are the first carbon transfer to be applied to each record. Half the annual increment is then added (transfer from the atmosphere to the three above ground biomass pools - <code>Merch</code>, <code>Foliage</code>, and <code>Other</code>). Disturbances are processes externally to <a href="https://github.com/PredictiveEcology/CBM_core.git">CBM_core</a>, in our example the are processes in <a href="https://github.com/PredictiveEcology/CBM_dataPrep_SK.git">CBM_dataPrep_SK</a>. Disturbance matrices specify the proportion of carbon in each pool to be transferred to other pools or to be taken out of the system (via forest products (pool named <code>Products</code>) or back to the atmosphere). The amount of carbon transferred from the atmosphere to the aboveground biomass pools is determined from the growth curves, which were translated from <span class="math inline">\(m^3/ha\)</span> to carbon increments in <a href="https://github.com/PredictiveEcology/CBM_vol2biomass.git">CBM_vol2biomass</a> and provided to <a href="https://github.com/PredictiveEcology/CBM_core.git">CBM_core</a>. Dead Organic Matter (<a href="link%20to%20lexicon">DOM</a>) turnover happens next and transfers carbon from the pools representing snags (stem snags and branches snags), to the MediumSoil, and AboveGroundFastSoil pools. Biomass turnover follows with transfers from the Merch, Foliage, Other, fine and coarse roots, to the pools representing the snags (both stem and branch snage), AboveGroundVeryFastSoil, BelowGroundFastSoil, AboveGroundVeryFastSoil and BelowGroundVeryFastSoil pools. The second half of the growth is then added to the three above ground biomass pools - <code>Merch</code>, <code>Foliage</code>, and `Other.</p>
</div>
<div id="inputs-3" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> Inputs<a class="anchor" aria-label="anchor" href="#inputs-3"><i class="fas fa-link"></i></a>
</h2>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="22%">
<col width="22%">
<col width="31%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th>Name</th>
<th>Class</th>
<th>Description</th>
<th>Source</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>growth_increments</td>
<td>Data table</td>
<td>1/2 growth increment matrix</td>
<td>CBM_vol2biomass</td>
</tr>
<tr class="even">
<td>level3DT</td>
<td>Data table</td>
<td>pixelGroup level table with all collapsed raster information</td>
<td>CBM_dataPrep_SK</td>
</tr>
<tr class="odd">
<td>spatialDT</td>
<td>Data table</td>
<td>Pixel level table with all collapsed raster information</td>
<td>CBM_dataPrep_SK</td>
</tr>
<tr class="even">
<td>masterRaster</td>
<td>SpatRaster</td>
<td>Raster of study area</td>
<td>User provided, for SK: <a href="https://drive.google.com/file/d/1zUyFH8k6Ef4c_GiWMInKbwAl6m6gvLJW">Google Drive</a>
</td>
</tr>
<tr class="odd">
<td>pooldef</td>
<td>Character</td>
<td>Vector of pools</td>
<td>CBM_defaults</td>
</tr>
<tr class="even">
<td>spinupSQL</td>
<td>Data table</td>
<td>Parameters for CBM_core spinup event</td>
<td>CBM_defaults</td>
</tr>
<tr class="odd">
<td>speciesPixelGroup</td>
<td>Data table</td>
<td>Data table</td>
<td>Table connecting pixel groups to species IDs</td>
</tr>
<tr class="even">
<td>realAges</td>
<td>Numeric</td>
<td>Extracted ages for each pixel group</td>
<td>CBM_dataPrep_SK</td>
</tr>
<tr class="odd">
<td>mySpuDmids</td>
<td>Data table</td>
<td>Summary table of possible CBM-CFS3 disturbances within study area spatial units</td>
<td>CBM_dataPrep_SK</td>
</tr>
<tr class="even">
<td>disturbanceRasters</td>
<td>Character</td>
<td>Disturbance rasters for the study area for the duration of simulation</td>
<td>User provided, for SK: <a href="https://drive.google.com/file/d/12YnuQYytjcBej0_kdodLchPg7z9LygCt">Google Drive</a>
</td>
</tr>
<tr class="odd">
<td>disturbanceMatrix</td>
<td>Data table</td>
<td>Default disturbance data</td>
<td>CBM_defaults</td>
</tr>
<tr class="even">
<td>historicDMtype</td>
<td>Numeric</td>
<td>Historical disturbance type for each pixel group</td>
<td>CBM_dataPrep_SK</td>
</tr>
<tr class="odd">
<td>lastPassDMtype</td>
<td>Numeric</td>
<td>Last pass disturebance type for each pizel group</td>
<td>CBM_dataPrep_SK</td>
</tr>
</tbody>
</table></div>
</div>
<div id="module-functioning-3" class="section level2" number="4.4">
<h2>
<span class="header-section-number">4.4</span> Module functioning<a class="anchor" aria-label="anchor" href="#module-functioning-3"><i class="fas fa-link"></i></a>
</h2>
</div>
<div id="outputs-3" class="section level2" number="4.5">
<h2>
<span class="header-section-number">4.5</span> Outputs<a class="anchor" aria-label="anchor" href="#outputs-3"><i class="fas fa-link"></i></a>
</h2>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="24%">
<col width="24%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>Name</th>
<th>Class</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>spinup_input</td>
<td>List</td>
<td>input parameters for the spinup functions</td>
</tr>
<tr class="even">
<td>cbm_vars</td>
<td>List</td>
<td>List of 4 data tables: parameters, pools, flux, and state</td>
</tr>
<tr class="odd">
<td>spinupResults</td>
<td>Data frame</td>
<td>Pools post spinup in order of pixelGroup</td>
</tr>
<tr class="even">
<td>pixelGroupC</td>
<td>Data table</td>
<td>All vectors (pixelGroup columns) and pools for simulation year.</td>
</tr>
<tr class="odd">
<td>pixelKeep</td>
<td>Data table</td>
<td>Tracking all pixels’ pixel group through simulations</td>
</tr>
<tr class="even">
<td>cbmPools</td>
<td>Data table</td>
<td>All pools and pixelGroups after each simulation</td>
</tr>
<tr class="odd">
<td>NPP</td>
<td>Data table</td>
<td>Net primary production per pixel group</td>
</tr>
<tr class="even">
<td>emissionsProducts</td>
<td>matrix</td>
<td>Total emissions and products for study area per simulation year</td>
</tr>
</tbody>
</table></div>
</div>
<div id="links-to-other-modules-3" class="section level2" number="4.6">
<h2>
<span class="header-section-number">4.6</span> Links to other modules<a class="anchor" aria-label="anchor" href="#links-to-other-modules-3"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><a href="https://github.com/PredictiveEcology/CBM_defaults">CBM_defaults</a></li>
<li><a href="https://github.com/PredictiveEcology/CBM_dataPrep_SK.git">CBM_dataPrep_SK</a></li>
<li><a href="https://github.com/PredictiveEcology/CBM_vol2biomass">CBM_vol2biomass</a></li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="cbm_vol2biomass.html"><span class="header-section-number">3</span> CBM_vol2biomass</a></div>
<div class="next"><a href="references.html">References</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#cbm_core"><span class="header-section-number">4</span> CBM_core</a></li>
<li><a class="nav-link" href="#overview-4"><span class="header-section-number">4.1</span> Overview</a></li>
<li><a class="nav-link" href="#background-3"><span class="header-section-number">4.2</span> Background</a></li>
<li><a class="nav-link" href="#inputs-3"><span class="header-section-number">4.3</span> Inputs</a></li>
<li><a class="nav-link" href="#module-functioning-3"><span class="header-section-number">4.4</span> Module functioning</a></li>
<li><a class="nav-link" href="#outputs-3"><span class="header-section-number">4.5</span> Outputs</a></li>
<li><a class="nav-link" href="#links-to-other-modules-3"><span class="header-section-number">4.6</span> Links to other modules</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/PredictiveEcology/spadesCBM/blob/main/../modules/CBM_core/CBM_core.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/PredictiveEcology/spadesCBM/edit/main/../modules/CBM_core/CBM_core.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>spadesCBM</strong>: v. 0.1" was written by Céline Boisvenue. It was last built on 26 June 2024.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
